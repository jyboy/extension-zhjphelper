function sendMessageRequest(e,t){var n=!1;"-1"==e&&(n=!0),chrome.storage.local.set({isRunning:n},function(){chrome.extension.sendRequest({type:e,message:t},function(e){})})}function reserveCoach(){var e=!1,t=$("iframe[name='培训预约']").contents().find("body"),n=0;t.find(".dhx_cal_today_button").click(),t.find("#CoachScheduler").children(".dhx_cal_header").children("div").children(".dhx_scale_bar").each(function(){if(timeShortArray.indexOf($(this).text())!=-1&&(leftArray.push($(this).css("left")),n++,6==n))return!1});var r=setInterval(function(){t=$("iframe[name='培训预约']").contents().find("body"),t.find(".dhx_cal_today_button").click();for(var n=0;n<reservationDate;n++)t.find(".dhx_cal_next_button").click();var i=t.find("#CoachScheduler").children(".dhx_cal_data").children("table").children("tbody").children("tr");if("无"!=i.first().children("td").first().text()&&!e){var c=!1,a=!1;i.each(function(){if($(this).children("td").first().text()==firstCoach){var e=$(this).children("td").last().children(".dhx_matrix_line").children(".dhx_cal_event_line");if(e.length){var t=!1;e.each(function(){if(str2num($(this).css("left"))+str2num(leftArray[0])-str2num(leftArray[timeArray.indexOf(firstTime)])==1)return $(this).click(),afterTimeClick(),t=!0,c=!0,!1}),(!t&&secondTime||canTwoTime)&&e.each(function(){if(str2num($(this).css("left"))+str2num(leftArray[0])-str2num(leftArray[timeArray.indexOf(secondTime)])==1)return $(this).click(),afterTimeClick(),c=!0,!1})}return!1}}),!c&&secondCoach&&i.each(function(){if($(this).children("td").first().text()==secondCoach){var e=$(this).children("td").last().children(".dhx_matrix_line").children(".dhx_cal_event_line");if(e.length){var t=!1;e.each(function(){if(str2num($(this).css("left"))+str2num(leftArray[0])-str2num(leftArray[timeArray.indexOf(firstTime)])==1)return $(this).click(),afterTimeClick(),t=!0,a=!0,!1}),(!t&&secondTime||canTwoTime)&&e.each(function(){if(str2num($(this).css("left"))+str2num(leftArray[0])-str2num(leftArray[timeArray.indexOf(secondTime)])==1)return $(this).click(),afterTimeClick(),a=!0,!1})}return!1}}),c||a?sendMessageRequest("3",""):sendMessageRequest("2",""),e=!0}chrome.storage.local.get("isRunning",function(e){e.isRunning||clearInterval(r)})},250)}function str2num(e){return parseInt(e.substr(0,e.length-2))}function afterTimeClick(){var e=setInterval(function(){if($("#LearnInfo_executeButton").length&&$("#LearnInfo_executeButton").get(0).click(),"none"==$("div.window").css("display")){clearInterval(e);var t=!1,n=setInterval(function(){if($(".messager-window").length||$(".window-shadow").length||$(".window-mask").length)t=!0,$(".messager-window").remove(),$(".window-shadow").remove(),$(".window-mask").remove();else if(t){clearInterval(n);var e=!1,r=setInterval(function(){$("#thumbviewbox").length?(e=!0,$("#thumbviewbox").remove()):e&&clearInterval(r)},25)}},25)}},100)}var reservationDate,firstCoach,secondCoach,firstTime,secondTime,canTwoTime,leftArray=[],timeShortArray=["06:00","07:00","09:00","12:00","14:00","16:00"],timeArray=["","07:00 ~ 09:00","09:00 ~ 11:00","12:00 ~ 14:00","14:00 ~ 16:00","16:00 ~ 18:00"];if($("iframe[name='培训预约']").length){var $body=$("iframe[name='培训预约']").contents().find("body");if($body.attr("onload")){var count=0;chrome.storage.local.get("reservationDate",function(e){reservationDate=e.reservationDate,count++,6==count&&reserveCoach()}),chrome.storage.local.get("firstCoach",function(e){firstCoach=e.firstCoach,count++,6==count&&reserveCoach()}),chrome.storage.local.get("secondCoach",function(e){secondCoach=e.secondCoach,count++,6==count&&reserveCoach()}),chrome.storage.local.get("firstTime",function(e){firstTime=e.firstTime,count++,6==count&&reserveCoach()}),chrome.storage.local.get("secondTime",function(e){secondTime=e.secondTime,count++,6==count&&reserveCoach()}),chrome.storage.local.get("canTwoTime",function(e){canTwoTime=e.canTwoTime,count++,6==count&&reserveCoach()}),sendMessageRequest("-1",$("#userName").text().split(" - ")[0])}else sendMessageRequest("1","")}else sendMessageRequest("0","");